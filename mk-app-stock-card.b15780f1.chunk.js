webpackJsonp([16],{1829:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var a,i,o=r(2),c=n(o),d=r(55),u=n(d),s=r(5),f=n(s),l=r(10),m=n(l),h=r(8),p=n(h),v=r(9),w=n(v),g=r(0),x=(n(g),r(252)),k=r(677),R=n(k),y=(a=(0,x.wrapper)(R.default))(i=function(e){function t(){return(0,f.default)(this,t),(0,p.default)(this,(t.__proto__||(0,u.default)(t)).apply(this,arguments))}return(0,w.default)(t,e),(0,m.default)(t,[{key:"render",value:function(){return this.props.monkeyKing((0,c.default)({},this.props,{path:"root"}))}}]),t}(g.Component))||i;t.default=y,e.exports=t.default},1830:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=new x.action(e),r=new U((0,o.default)({},e,{metaAction:t})),n=(0,o.default)({},t,r);return t.config({metaHandlers:n}),n}Object.defineProperty(t,"__esModule",{value:!0});var i=r(2),o=n(i),c=r(7),d=n(c),u=r(566),s=n(u),f=r(567),l=n(f),m=r(5),h=n(m),p=r(10),v=n(p);t.default=a;var w=r(0),g=n(w),x=r(252),k=r(602),R=n(k),y=r(12),C=n(y),b=r(72),A=["unit","conversionRate","conversionDesc","isBase","isPu","isSa","isSt"],P=["unit","lastPuPrice","referPuPrice","lastSaPrice","retailPrice","firstTradePrice","secondTradePrice","thirdTradePrice","fourthTradePrice","fifthTradePrice","sixthTradePrice","servenTradePrice","eighthTradePrice","ninthTradePrice","tenthTradePrice"],S=["barcode","unit"],U=function(){function e(t){var r=this;(0,h.default)(this,e),this.onInit=function(e){var t=e.component,n=e.injections;r.component=t,r.injections=n,n.reduce("init"),r.load()},this.load=(0,l.default)(s.default.mark(function e(){var t;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.webapi.stock.init({id:r.component.props.stockId});case 2:t=e.sent,r.injections.reduce("load",t);case 4:case"end":return e.stop()}},e,r)})),this.prev=(0,l.default)(s.default.mark(function e(){var t,n;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.metaAction.gf("data.form.id"),e.next=3,r.webapi.stock.prev(t);case 3:n=e.sent,n&&r.injections.reduce("setForm",n);case 5:case"end":return e.stop()}},e,r)})),this.next=(0,l.default)(s.default.mark(function e(){var t,n;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=r.metaAction.gf("data.form.id"),e.next=3,r.webapi.stock.next(t);case 3:n=e.sent,n&&r.injections.reduce("setForm",n);case 5:case"end":return e.stop()}},e,r)})),this.add=function(){r.injections.reduce("setForm")},this.save=(0,l.default)(s.default.mark(function e(){var t,n,a,i;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=r.metaAction.gf("data.form").toJS(),n=r.checkSave(t),!(n.length>0)){e.next=5;break}return r.metaAction.toast("error",g.default.createElement("ul",{style:{textAlign:"left"}},n.map(function(e){return g.default.createElement("li",null,e)}))),e.abrupt("return");case 5:if(!t.id&&0!=t.id){e.next=12;break}return e.next=8,r.webapi.stock.update(t);case 8:a=e.sent,a&&(r.metaAction.toast("success","保存存货成功"),r.injections.reduce("setForm",a)),e.next=16;break;case 12:return e.next=14,r.webapi.stock.create(t);case 14:i=e.sent,i&&(r.metaAction.toast("success","保存存货成功"),r.injections.reduce("setForm",i));case 16:case"end":return e.stop()}},e,r)})),this.tabChange=function(e){r.metaAction.sf("data.other.tabKey",e)},this.categoryChange=function(e){var t=r.metaAction.gf("data.other.categories"),n=t.find(function(t){return t.get("id")==e});r.metaAction.sf("data.form.category",n)},this.pricingModeChange=function(e){var t=r.metaAction.gf("data.other.pricingModes"),n=t.find(function(t){return t.get("id")==e});r.metaAction.sf("data.form.pricingMode",n)},this.getTypeDropdownChildren=function(e){if(e)return{_isMeta:!0,value:C.default.tree.map(e,"children","",function(e){return{name:e.id,component:"TreeSelect.TreeNode",key:e.id,title:e.name,value:e.id,children:e.children}})}},this.typeChange=function(e){var t=r.metaAction.gf("data.other.types").toJS(),n=C.default.tree.find(t,"children",function(t){return t.id==e});r.metaAction.sf("data.form.type",(0,b.fromJS)(n))},this.typeFocus=(0,l.default)(s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,r)})),this.addType=(0,l.default)(s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:case"end":return e.stop()}},e,r)})),this.getImg=function(){return img},this.taxRateChange=function(e){var t=r.metaAction.gf("data.other.taxRates"),n=t.find(function(t){return t.get("id")==e});r.metaAction.sf("data.form.taxRate",n)},this.meaUnitChange=function(e){var t=r.metaAction.gf("data.other.meaUnits"),n=t.find(function(t){return t.get("id")==e});r.metaAction.sf("data.form.meaUnit",n)},this.meaUnitFocus=(0,l.default)(s.default.mark(function e(){var t;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,r.webapi.meaUnit.query();case 2:t=e.sent,r.metaAction.sf("data.other.meaUnits",(0,b.fromJS)(t));case 4:case"end":return e.stop()}},e,r)})),this.addMeaUnit=(0,l.default)(s.default.mark(function e(){return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:r.addUnit("data.form.meaUnit");case 1:case"end":return e.stop()}},e,r)})),this.addMeaUnit4UnitGird=function(e){return(0,l.default)(s.default.mark(function t(){return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r.addUnit("data.form.units."+e+".unit");case 1:case"end":return t.stop()}},t,r)}))},this.addMeaUnit4PriceGird=function(e){return(0,l.default)(s.default.mark(function t(){return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r.addUnit("data.form.prices."+e+".unit");case 1:case"end":return t.stop()}},t,r)}))},this.addMeaUnit4barcodeGird=function(e){return(0,l.default)(s.default.mark(function t(){return s.default.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:r.addUnit("data.form.barcodes."+e+".unit");case 1:case"end":return t.stop()}},t,r)}))},this.addUnit=function(){var e=(0,l.default)(s.default.mark(function e(t){var n,a;return s.default.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(r.config.apps["mk-app-mea-unit-card"]){e.next=2;break}throw"依赖mk-app-mea-unit-card app,请使用mk clone mk-app-mea-unit-card命令添加";case 2:return e.next=4,r.metaAction.modal("show",{title:"新增",children:r.metaAction.loadApp("mk-app-mea-unit-card",{store:r.component.props.store})});case 4:if(!(n=e.sent)){e.next=10;break}return e.next=8,r.webapi.meaUnit.query();case 8:a=e.sent,r.metaAction.sfs((0,d.default)({"data.other.meaUnits":(0,b.fromJS)(a)},t,(0,b.fromJS)(n)));case 10:case"end":return e.stop()}},e,r)}));return function(t){return e.apply(this,arguments)}}(),this.imgChange=function(e){r.metaAction.sf("data.other.selectedImgIndex",e)},this.addImg=function(){r.metaAction.toast("error","静态网站未实现")},this.delImg=function(){r.injections.reduce("delImg")},this.mousedown=function(e){var t=C.default.path.findPathByEvent(e);if(!r.metaAction.isFocus(t))if(-1!=t.indexOf("cell.cell"))r.focusCell(r.getCellInfo(t),t);else{if(!r.metaAction.focusByEvent(e))return;setTimeout(r.cellAutoFocus,16)}},this.gridKeydown=function(e){var t="";if(37!=e.keyCode&&39!=e.keyCode&&13!=e.keyCode&&108!=e.keyCode&&9!=e.keyCode&&38!=e.keyCode&&40!=e.keyCode||(t=C.default.path.findPathByEvent(e))&&-1!=t.indexOf(",")){if(37==e.keyCode){if(!C.default.dom.cursorAtBegin(e))return;return void r.moveEditCell(t,"left")}if(39==e.keyCode||13==e.keyCode||108==e.keyCode||9==e.keyCode){if(!C.default.dom.cursorAtEnd(e))return;return void r.moveEditCell(t,"right")}return 38==e.keyCode?void r.moveEditCell(t,"up"):40==e.keyCode?void r.moveEditCell(t,"down"):void 0}},this.cellAutoFocus=function(){C.default.dom.gridCellAutoFocus(r.component,".editable-cell")},this.getCellClassName=function(e,t){var n=r.metaAction.isFocus(e)?"mk-app-stock-card-cell editable-cell":"";return t&&(n+=" mk-app-stock-card-cell-"+t),n},this.addUnitRow=function(e){r.injections.reduce("addUnitRow",e.rowIndex+1)},this.delUnitRow=function(e){r.injections.reduce("delUnitRow",e.rowIndex)},this.addPriceRow=function(e){r.injections.reduce("addPriceRow",e.rowIndex+1)},this.delPriceRow=function(e){r.injections.reduce("delPriceRow",e.rowIndex)},this.addBarcodeRow=function(e){r.injections.reduce("addBarcodeRow",e.rowIndex+1)},this.delBarcodeRow=function(e){r.injections.reduce("delBarcodeRow",e.rowIndex)},this.unitsUnitChange=function(e){return function(t){var n=r.metaAction.gf("data.other.meaUnits"),a=n.find(function(e){return e.get("id")==t});r.metaAction.sf("data.form.units."+e+".unit",a)}},this.numberFormat=function(e,t,r){return e?t:C.default.number.format(t,r)},this.metaAction=t.metaAction,this.config=R.default.current,this.webapi=this.config.webapi}return(0,v.default)(e,[{key:"checkSave",value:function(e){var t=[];return e.code||t.push("存货编码不能为空!"),e.name||t.push("存货名称不能为空!"),t}},{key:"moveEditCell",value:function(e,t){var r=this.getCellInfo(e);this.moveCell(r,t,e)}},{key:"moveCell",value:function(e,t,r){var n=C.default.matrix.move(e.rowCount,e.colCount,{x:e.x,y:e.y},t);this.focusCell(n,r)}},{key:"focusCell",value:function(e,t){-1!=t.indexOf("unitGrid")?this.metaAction.sfs({"data.other.focusFieldPath":"root.children.base.children.zone2.children.unitGrid.columns."+A[e.x]+".cell.cell,"+e.y,"data.other.unitGridScrollToRow":e.y,"data.other.unitGridScrollToColumn":e.x+1}):-1!=t.indexOf("priceGrid")?this.metaAction.sfs({"data.other.focusFieldPath":"root.children.base.children.zone3.children.priceGrid.columns."+P[e.x]+".cell.cell,"+e.y,"data.other.priceGridScrollToRow":e.y,"data.other.priceGridScrollToColumn":e.x+1}):-1!=t.indexOf("barcodeGrid")&&this.metaAction.sfs({"data.other.focusFieldPath":"root.children.barcode.children.barcodeGrid.columns."+S[e.x]+".cell.cell,"+e.y,"data.other.priceGridScrollToRow":e.y,"data.other.priceGridScrollToColumn":e.x+1}),setTimeout(this.cellAutoFocus,16)}},{key:"getCellInfo",value:function(e){var t=C.default.path.parsePath(e);if(-1!=e.indexOf("unitGrid")){var r=this.metaAction.gf("data.form.units").size,n=t.path.replace("root.children.base.children.zone2.children.unitGrid.columns.","").replace(".cell.cell","").replace(/\s/g,"");return{x:A.findIndex(function(e){return e==n}),y:Number(t.vars[0]),colCount:7,rowCount:r}}if(-1!=e.indexOf("priceGrid")){var a=this.metaAction.gf("data.form.prices").size,n=t.path.replace("root.children.base.children.zone3.children.priceGrid.columns.","").replace(".cell.cell","").replace(/\s/g,"");return{x:P.findIndex(function(e){return e==n}),y:Number(t.vars[0]),colCount:15,rowCount:a}}if(-1!=e.indexOf("barcodeGrid")){var i=this.metaAction.gf("data.form.barcodes").size,n=t.path.replace("root.children.barcode.children.barcodeGrid.columns.","").replace(".cell.cell","").replace(/\s/g,"");return{x:S.findIndex(function(e){return e==n}),y:Number(t.vars[0]),colCount:2,rowCount:i}}}}]),e}();e.exports=t.default},1831:function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function a(e){var t=new s.reducer(e),r=new h((0,o.default)({},e,{metaReducer:t}));return(0,o.default)({},t,r)}Object.defineProperty(t,"__esModule",{value:!0});var i=r(2),o=n(i),c=r(5),d=n(c);t.default=a;var u=r(72),s=r(252),f=r(602),l=n(f),m=r(678),h=function e(t){var r=this;(0,d.default)(this,e),this.init=function(e,t){var n=(0,m.getInitState)();return r.metaReducer.init(e,n)},this.load=function(e,t){var n=t.stock,a=t.stockCategories,i=t.pricingModes,o=t.stockTypes,c=t.taxRates,d=t.meaUnits;return e=n?r.metaReducer.sf(e,"data.form",(0,u.fromJS)(n)):r.metaReducer.sf(e,"data",(0,u.fromJS)((0,m.getInitState)().data)),e=r.metaReducer.sf(e,"data.other.categories",(0,u.fromJS)(a)),e=r.metaReducer.sf(e,"data.other.pricingModes",(0,u.fromJS)(i)),e=r.metaReducer.sf(e,"data.other.types",(0,u.fromJS)(o)),e=r.metaReducer.sf(e,"data.other.taxRates",(0,u.fromJS)(c)),e=r.metaReducer.sf(e,"data.other.meaUnits",(0,u.fromJS)(d)),r.metaReducer.gf(e,"data.form.barcodes")||(e=r.metaReducer.sf(e,"data.form.barcodes",(0,u.fromJS)([{}]))),e},this.setForm=function(e,t){return e=t?r.metaReducer.sf(e,"data.form",(0,u.fromJS)(t)):r.metaReducer.sf(e,"data.form",(0,u.fromJS)((0,m.getInitState)().data.form)),r.metaReducer.gf(e,"data.form.barcodes")||(e=r.metaReducer.sf(e,"data.form.barcodes",(0,u.fromJS)([{}]))),e},this.addUnitRow=function(e,t){return r.addRow(e,"data.form.units",t)},this.delUnitRow=function(e,t){return r.delRow(e,"data.form.units",t)},this.addPriceRow=function(e,t){return r.addRow(e,"data.form.prices",t)},this.delPriceRow=function(e,t){return r.delRow(e,"data.form.prices",t)},this.addBarcodeRow=function(e,t){return r.addRow(e,"data.form.barcodes",t)},this.delBarcodeRow=function(e,t){return r.delRow(e,"data.form.barcodes",t)},this.addRow=function(e,t,n){var a=r.metaReducer.gf(e,t);return a=a.insert(n,(0,u.Map)({})),r.metaReducer.sf(e,t,a)},this.delRow=function(e,t,n){var a=r.metaReducer.gf(e,t);return-1==n?e:(a=a.remove(n),0==a.size&&(a=a.insert(n,(0,u.Map)({}))),r.metaReducer.sf(e,t,a))},this.delImg=function(e){var t=r.metaReducer.gf(e,"data.form.imgs");if(!t||0==t.size)return e;var n=r.metaReducer.gf(e,"data.other.selectedImgIndex")||0;return e=r.metaReducer.sf(e,"data.form.imgs",t.remove(n)),e=r.metaReducer.sf(e,"data.other.selectedImgIndex",void 0)},this.metaReducer=t.metaReducer,this.config=l.default.current};e.exports=t.default}});